---
output: html_document
editor_options: 
  chunk_output_type: console
execute: 
  warning: false
---
<!--- js dependencies -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="js/scatterplot.js"></script>

```{r}
#| include: false
oldwd <- getwd()
setwd('~/Desktop/visa-lago/')
source(knitr::purl('explore.qmd'))
setwd(oldwd)
```

```{r}
ojs_define(
  country_level_2022 = country_level_2022 %>% 
    select(
      consulate_country,
      consulate_country_continent,
      tot_request,
      gdp_per_capita,
      ratio_rejected,
      fitted = .fitted
    ) %>% 
    drop_na() %>% 
    {
    transpose(.l = .)
  }
)
```

```{ojs}
height = 500
cb_palette = {
  let cb_palette = {
  Africa: "#228833",
  Americas: "#CCBB44",
  Asia: "#4477AA",
  Europe: "#EE6677",
  Oceania: "#AA3377",
  }
  return cb_palette
}
```

```{ojs} 
Scatterplot(country_level_2022,
  {
    x: d => d.gdp_per_capita,
    y: d => d.ratio_rejected,
    area: d => d.tot_request,
    fill: d => d.consulate_country_continent,
    fitted: d => d.fitted,
    fillPalette: cb_palette,
    width: width,
    height: height,
  }
)
```


```{r}
#| fig-width: 12
#| fig-height: 6
plot_model(country_level_2022, year = 2022, gdp_year = 2021)
```

:::: {.grid}

::: {.g-col-12 .g-col-md-6}

### Data Sources

Data on short-term visa applications and rejection rate are released publicly by the Directorate-General for Migration and Home Affairs of the European Commission, and are [available on their website](https://home-affairs.ec.europa.eu/policies/schengen-borders-and-visa/visa-policy_en#paragraph_1903).

Data on GDP per capita are estimated and made available by the World Bank, [on their website](https://datacatalog.worldbank.org/search/dataset/0037712/World-Development-Indicators). We have used the “GDP per capita, at purchasing power parity (current international $)” indicator as a basic measurement indicating average wealth per nation.
Data Analysis

:::

::: {.g-col-12 .g-col-md-6}

### Data Analysis

We have used ISO3166 alpha-3-codes to merge the data in the two datasets, relying on the R package [countrycode](https://joss.theoj.org/papers/10.21105/joss.00848) to convert country names into country codes when needed.

The regression line uses a [binomial generalised linear model](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/00Index.html) to estimate conservatively how much we can expect the application rejection rate to increase when the GDP per capita of the originating country decreases. 

African countries are often outliers, with rejection rates well above what is expected by the regression line.

:::

::::